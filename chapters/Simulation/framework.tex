\subsection{Simulation framework}

The ATLAS simulation program is integrated into the ATLAS software framework called \textit{Athena}\cite{atlas:athena},
which uses Python as an object-oriented scripting and interpreter language to configure and load C++ algorithms and objects.
Figure~\ref{fig:frame_overview} shows the overview of ATLAS simulation data flow\cite{Aad:2010ah}.
In the diagrams, the square-cornered boxes represents algorithms and applications to be run and round-cornered boxes denote data objects.
\begin{figure}[!htb]
  \centering
  \includegraphics[width=1.0\textwidth]{figures/Simulation/outline_atalsSimulation_v2.png}
  \caption{The flow of the ATLAS simulation software.}
  \label{fig:frame_overview}
\end{figure}

First of all, events are produced by MC generators in standard HepMC format and then read into the simulation.
During the simulation, particles are propagated through the full ATLAS detector whose configurations can be set by users via GEANT4 toolkit.
The energies deposited in the sensitive regions of the detector are recorded as \textit{hits}, which contains the total energy deposition,
position, and time, and are written to a simulation hit file.
In the meatime, the events in "truth" format are also recorded to contain the history of the interactions from the generator, including incoming and outgoing particles.
Simulated Data Objects (SDOs) are created from truth, which are maps between hits in sensitive portions of the detector and truth information of particles in simulation.
The files are then sent to digitization, which firstly constructs "digits" inputs to the read out drivers (RODs) in the detector electronics.
Then the ROD is emulated, from which one can get a Raw Data Object (RDO) file used for reconstruction.

In conclusion, there are three main parts of framework: \textit{Generation}, \textit{Simulation} and \textit{Reconstruction}. 
More details are given below.

\textbf{Event generation}

As shown in figure~\ref{fig:mc_event_structure}\cite{Hoche:2014rga}, at hardon colliders, multiple scattering and rescattering effects arise, which must be simulated by Monte Carlo (MC) event generators to reflect the full complexity of those event structures.
Several MC event generators can be used to generate events originally in HepMC format.
The events can be filtered at generation time with some certain requirements (eg. decay channel or missing energy above a certain threshold).
The generator is responsible for any prompt decays (e.g. W or Z bosons) but stores any "stable" particle expected to propagate through a part of the detector. 
During the generation steps, any interactions with detector are ignored and only immediate decays are considered.

There are several MC generators that have been widely-used with general purpose, which include Sherpa\cite{Gleisberg_2009}, Herwig++\cite{Bahr2008}, PowhegBox\cite{Nason:2004rx}, MC@NLO\cite{Frixione_2002} and Pythia8\cite{Sjostrand:2007gs}.

\begin{figure}[!htb]
  \centering
  \includegraphics[width=0.5\textwidth]{figures/Simulation/mc_event_structure.png}
  \caption{Sketch of a hardon-hardon collision simulated by MC event generator. The red blob in center denotes the hard collision, surrounded by tree-like structures representing Bremsstrahlung which is simulated by Parton Showers. The purple blob stands for a secondary hard scattering event. The light green blobs indecate the parton-to-hardon transitions and the dark green blobs represents hardon decays. The yellow lines are soft photon radiations.}
  \label{fig:mc_event_structure}
\end{figure}
